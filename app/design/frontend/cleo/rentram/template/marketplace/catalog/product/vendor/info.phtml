<?php
/**
 * Medma Marketplace
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Team
 * that is bundled with this package of Medma Infomatix Pvt. Ltd.
 * =================================================================
 *                 MAGENTO EDITION USAGE NOTICE
 * =================================================================
 * This package designed for Magento COMMUNITY edition
 * Contact us Support does not guarantee correct work of this package
 * on any other Magento edition except Magento COMMUNITY edition.
 * =================================================================
 *
 * @category    Medma
 * @package     Medma_MarketPlace
**/
$isCustomerLoggedIn = Mage::getSingleton('customer/session')->isLoggedIn();
$vendorRating = $this->getVendorRating();
$vendorInfo = $this->getVendorInfo();
$_product = $this->getProduct();

   $categoryIds = $_product->getCategoryIds();
	 if(count($categoryIds) ){
            $firstCategoryId = $categoryIds[1];
            $secondCategoryId = $categoryIds[2];
            $categoryData = Mage::getModel('catalog/category')->load($secondCategoryId);
            $_category = Mage::getModel('catalog/category')->load($firstCategoryId);
        }

     //    Mage::log(	$categoryIds ,Zend_log::INFO,'layout.log',true);
//    Mage::log($_product->getId(),Zend_log::INFO,'layout.log',true);

?>
<?php   if($vendorInfo): ?>
<div class="box-collateral box-description">
	<div class="std">
    <table class="data-table" id="product-attribute-specs-table">
		        <colgroup><col style="width: 25%">
		        <col>
		        </colgroup>
						<tbody>
		            <tr>
		                <th class="label">Shop Name</th>
		                <td class="data">
										<!--		<php if($_category->getName()=="Construction Equipments"): ?>
												<a style="font-size: 17px; text-decoration: underline; color: cornflowerblue;" href="<php echo $this->getVendorProfileUrl($vendorInfo->getId()); ?>" >
													<php  echo $vendorInfo->getShopName(); ?>
												</a>
												<php endif; ?>  -->
												<?php echo $vendorInfo->getShopName(); ?>
										</td>
                    <td class="data" rowspan="5">
                      <?php if(count($vendorRating)): ?>
                      <table class="data-table" id="product-attribute-specs-table" style="margin-left: 20%;">
                        	<tbody>
                            <tr>
                                  </tr>
                				<?php foreach($vendorRating as $rating): ?>
                            <tr>
                              <th class="label" style="border-style: none;text-align: center;"><?php echo $rating['name']; ?>:-</th>
                                <td class="data" style="border-style: none;text-align: center;">
                        					<div class="rating-container">
                        						<div class="rating-graphics-container">
                        							<div class="rating-blank"></div>
                        							<div class="rating-filled" style="width: <?php echo $rating['value'] ?>%"></div>
                        						</div>
                        					<!--	<div class="rating-totals"><php echo str_pad($rating['records'], 3, "0", STR_PAD_LEFT); ?></div>  -->
                        					</div>
                                </td>
                            </tr>
                				<?php endforeach; ?>
                        </tbody>
                      </table>
                			<?php endif; ?>
                    </td>
		            </tr>
								<?php if($_category->getName()=="Construction Equipments"): ?>
		            <tr >
		                <th class="label">Contact</th>
		                <td class="data">	<button  class="btn btn-default" data-toggle="modal" data-target="#deletePaperModel">View contact</button>	</td>
		            </tr>

								<?php endif; ?>
								<tr>
										<th class="label">City</th>
										<td class="data">		<?php 	echo $vendorInfo->getCity(); ?></td>
								</tr>
		            <tr>
		                <th class="label">Description</th>
		                <td class="data">	<?php 	echo $vendorInfo->getMessage(); ?></td>
		            </tr>
		        </tbody>
		    </table>

	</div>

	<div class="add-to-box" style="text-align: center;  margin-top: 1%;">
		<button type="button" title="<?php echo $this->__('Add to Favourite'); ?>" class="button"
			onclick="setLocation('<?php echo $this->getAddFavouriteUrl($vendorInfo->getId()); ?>');">
			<span><span><?php echo $this->__('Add to Favourite'); ?></span></span>
		</button>
	</div>
</div>


<div class="modal fade" id="deletePaperModel" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" ng-click="deleteRow()">
						<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
					</button>
					<h1 class="modal-title" id="myModalLabel" style="text-align:center;">Seller Enquiry</h1>
          <p class="modal-title"  style="text-align:center;">Please provide following details to help us serve you better.</p>
				</div>
				<div class="modal-body">
          <?php if($isCustomerLoggedIn): ?>
          <table class="data-table" id="product-attribute-specs-table">
                  <colgroup><col style="width: 25%">
                  <col>
                  </colgroup>
                  <tbody>
                    <tr>
                      <th class="label" style="    color: black;"><b>Contact Number : <b></th>
                      <td class="data">		<?php 	echo $vendorInfo->getContactNumber(); ?></td>
                    </tr>
                    <tr>
                      <th class="label" style="    color: black;"><b>Address</b></th>
                      <td class="data">		<?php 	echo $vendorInfo->getAddress(); ?></td>
                    </tr>
                  </tbody>
              </table>

            <?php else: ?><label>Please log in to view seller details.</label><?php endif; ?>

        </div>

document.getElementById('address').value='';

if('<?php echo $isCustomerLoggedIn ?>'){
  document.getElementById('name').value = "<?php echo $customerData['firstname'].' '.$customerData['lastname']  ?>";
  document.getElementById('email').value = "<?php echo $customerData['email'] ?>";
  document.getElementById('contact_number').value = "<?php echo $addressObject['telephone'] ?>";
  document.getElementById('address').value = "<?php echo $addressObject['street'].' '.$addressObject['city'].' '.$addressObject['city'] ?>";
}
  function informationPopup(){

    console.log("<?php $isSaved = Mage::getSingleton('core/session')->getData('isSaved'); echo $isSaved ?>");
    if(("<?php $isSaved = Mage::getSingleton('core/session')->getData('isSaved'); echo $isSaved ?>" || saveSuccess) && false){
      jQuery("#informationModel").modal("show");
    }else{
        jQuery("#detailModel").modal("show");
    }
  }
  function hideNameValidation(){
      var name = document.getElementById('name').value;
    if ( name == null ||  name == "") {
      document.getElementById('nameValidate').innerHTML = "Name is required field";
    }else{
      document.getElementById('nameValidate').innerHTML = "";
    }
  }
  function hideEmailValidation(){

    var email = document.getElementById('email').value;
    if(  email == null ||   email == "" ){
        document.getElementById('emailValidate').innerHTML = "Email is required field";
    }else if(!email.match(emailReg)){
        document.getElementById('emailValidate').innerHTML = "Email must in proper format eg:- demo@example.com";
    }else{
        document.getElementById('emailValidate').innerHTML = "";
    }

  }
  function hideContactValidation(){
    var phonenoReg = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
    var contact  =  document.getElementById('contact_number').value;
    if( contact == null ||   contact == "" ){
        document.getElementById('contactValidate').innerHTML = "Contact is required field";
    }else if(!contact.match(phonenoReg)){
        document.getElementById('contactValidate').innerHTML = "Mobile number must be in proper format eg:- 1234512345";
    }else{
        document.getElementById('contactValidate').innerHTML = "";
    }
  }


    function isValid(){
      var name = document.getElementById('name').value;
      var email = document.getElementById('email').value;
      var contact  =  document.getElementById('contact_number').value;
      var address  =  document.getElementById('address').value;
      var isValid = true ;
      var phonenoReg = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;

      if ( name == null ||  name == "") {
        document.getElementById('nameValidate').innerHTML = "Name is required field";
        isValid = false;
      }
      if(  email == null ||   email == "" ){
          document.getElementById('emailValidate').innerHTML = "Email is required field";
          isValid= false;
      }else if(!email.match(emailReg)){
          document.getElementById('emailValidate').innerHTML = "Email must in proper format eg:- demo@example.com";
          isValid = false;
      }
      if( contact == null ||   contact == "" ){
          document.getElementById('contactValidate').innerHTML = "Contact is required field";
          isValid = false;
      }else if(!contact.match(phonenoReg)){
          document.getElementById('contactValidate').innerHTML = "Mobile number must be in proper format eg:- 1234512345";
          isValid = false;
      }

      return isValid;
    }

   function saveData(){
            if(!isValid()){
              return;
            }

     document.getElementById('showBtn').innerHTML="Loading...";
              new Ajax.Request("<?php echo $this->getUrl('createLog/viewer/save') ?>", {
                  method: 'Post',
                  parameters: {
                     "name" : document.getElementById('name').value,
                     "email" :document.getElementById('email').value,
                     "contact_number" : document.getElementById('contact_number').value,
                     "address" : document.getElementById('address').value,
                     "customer_id" : document.getElementById('customer_id').value,
                     "product_id" : document.getElementById('product_id').value,
                     'product_name':"<?php echo $_product['name'] ?>",
                     'product_sku':"<?php echo $_product['sku'] ?>",
                     'vendor_id':"<?php echo $vendorInfo['entity_id'] ?>",
                     'vendor_name':"<?php echo $vendorInfo['shop_name'] ?>",
                     'category_id':"<?php echo $categoryData['entity_id'] ?>",
                     'category_name':"<?php echo $categoryData['name'] ?>"

                               },
                  onComplete: function(response) {

                    console.log(response);
                    saveSuccess= true;
                     document.getElementById('name').value = '';
                     document.getElementById('email').value = '';
                     document.getElementById('contact_number').value = '';
                     document.getElementById('address').value = '';
                     jQuery("#detailModel").modal("hide");
                      jQuery("#informationModel").modal("show");
                      document.getElementById('showBtn').innerHTML="Show Contact";
                      '<?php $isSaved ="true"; ?>';
                  }
              });
          }

</script>

        </div>
			</div>
		</div>
	</div>
<?php endif; ?>
