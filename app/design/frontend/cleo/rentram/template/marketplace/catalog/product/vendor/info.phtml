<?php
/**
 * Medma Marketplace
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Team
 * that is bundled with this package of Medma Infomatix Pvt. Ltd.
 * =================================================================
 *                 MAGENTO EDITION USAGE NOTICE
 * =================================================================
 * This package designed for Magento COMMUNITY edition
 * Contact us Support does not guarantee correct work of this package
 * on any other Magento edition except Magento COMMUNITY edition.
 * =================================================================
 *
 * @category    Medma
 * @package     Medma_MarketPlace
**/
$isCustomerLoggedIn = Mage::getSingleton('customer/session')->isLoggedIn();
if($isCustomerLoggedIn){
   $customerData = Mage::getSingleton('customer/session')->getCustomer();
   $customerId = $customerData->getId();
}
$currentDate =  Mage::getModel('core/date')->date('Y-m-d H:i:s');
  Mage::log(	$currentDate ,Zend_log::INFO,'layout.log',true);
$vendorRating = $this->getVendorRating();
$vendorInfo = $this->getVendorInfo();

$_product = $this->getProduct();
$productId = $_product->getId();
   $categoryIds = $_product->getCategoryIds();
	 if(count($categoryIds) ){
            $firstCategoryId = $categoryIds[1];
            $_category = Mage::getModel('catalog/category')->load($firstCategoryId);
        }
//    Mage::log($_product->getId(),Zend_log::INFO,'layout.log',true);


?>
<?php   if($vendorInfo): ?>
<div class="box-collateral box-description">
	<div class="std">
    <table class="data-table" id="product-attribute-specs-table">
		        <colgroup><col style="width: 25%">
		        <col>
		        </colgroup>
						<tbody>
		            <tr>
		                <th class="label">Shop Name</th>
		                <td class="data">
										<!--		<php if($_category->getName()=="Construction Equipments"): ?>
												<a style="font-size: 17px; text-decoration: underline; color: cornflowerblue;" href="<php echo $this->getVendorProfileUrl($vendorInfo->getId()); ?>" >
													<php  echo $vendorInfo->getShopName(); ?>
												</a>
												<php endif; ?>  -->
												<?php echo $vendorInfo->getShopName(); ?>
										</td>
                    <td class="data" rowspan="5">
                      <?php if(count($vendorRating)): ?>
                      <table class="data-table" id="product-attribute-specs-table" style="margin-left: 20%;">
                        	<tbody>
                            <tr>
                                  </tr>
                				<?php foreach($vendorRating as $rating): ?>
                            <tr>
                              <th class="label" style="border-style: none;text-align: center;"><?php echo $rating['name']; ?>:-</th>
                                <td class="data" style="border-style: none;text-align: center;">
                        					<div class="rating-container">
                        						<div class="rating-graphics-container">
                        							<div class="rating-blank"></div>
                        							<div class="rating-filled" style="width: <?php echo $rating['value'] ?>%"></div>
                        						</div>
                        					<!--	<div class="rating-totals"><php echo str_pad($rating['records'], 3, "0", STR_PAD_LEFT); ?></div>  -->
                        					</div>
                                </td>
                            </tr>
                				<?php endforeach; ?>
                        </tbody>
                      </table>
                			<?php endif; ?>
                    </td>
		            </tr>
								<?php if($_category->getName()=="Construction Equipments"): ?>
		            <tr >
		                <th class="label">Contact</th>
		                <td class="data">	<button  class="btn btn-default" data-toggle="modal" data-target="#deletePaperModel">View contact</button>	</td>
		            </tr>

								<?php endif; ?>
								<tr>
										<th class="label">City</th>
										<td class="data">		<?php 	echo $vendorInfo->getCity(); ?></td>
								</tr>
		            <tr>
		                <th class="label">Description</th>
		                <td class="data">	<?php 	echo $vendorInfo->getMessage(); ?></td>
		            </tr>
		        </tbody>
		    </table>

	</div>

	<div class="add-to-box" style="text-align: center;  margin-top: 1%;">
		<button type="button" title="<?php echo $this->__('Add to Favourite'); ?>" class="button"
			onclick="setLocation('<?php echo $this->getAddFavouriteUrl($vendorInfo->getId()); ?>');">
			<span><span><?php echo $this->__('Add to Favourite'); ?></span></span>
		</button>
	</div>
</div>


<div class="modal fade" id="deletePaperModel" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" ng-click="deleteRow()">
						<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
					</button>
					<h1 class="modal-title" id="myModalLabel" style="text-align:center;">Seller Information</h1>
				</div>
				<div class="modal-body">
              <input type="hidden" name="customer_id" id="customer_id" value="<?php echo $customerId; ?>" />
              <input type="hidden" name="product_id" id="product_id" value="<?php echo $productId; ?>" />
            <table class="data-table" id="product-attribute-specs-table">
                <colgroup><col style="width: 25%">
                <col>
                </colgroup>
                <tbody>
                  <tr>
                    <th class="label" style="    color: black;"><b>Name : <b></th>
                    <td class="data">
                      <input type="text" id="name" name="name" title="<?php echo $this->__('First Name'); ?>" maxlength="255" class="input-text required-entry">
      					    </td>
                  </tr>
                  <tr>
                    <th class="label" style="    color: black;"><b>Email :</b></th>
                    <td class="data">	<input type="text" name="email" id="email" title="<?php echo $this->__('Email Address') ?>" class="input-text validate-email required-entry" />
                    </td>
                  </tr>
                  <tr>
                    <th class="label" style="    color: black;"><b>Mobile :</b></th>
                    <td class="data">	<input type="text" id="contact_number" name="contact_number" title="<?php echo $this->__('Contact Number'); ?>" maxlength="255" class="input-text required-entry validate-phoneLax" >
      	             </td>
                  </tr>
                  <tr>
                    <th class="label" style="    color: black;"><b>Address :</b></th>
                    <td class="data">	<textarea id="address" name="address" title="<?php echo $this->__('Address'); ?>" maxlength="555" class="input-text required-entry" >
                                      </textarea>
                    </td>
                  </tr>
                  <tr>
                    <td></td>
                    <td class="data" ><button type="submit" onclick="saveData()" class="btn btn-round btn-success">Show Contact</button></td>
                  </tr>
                </tbody>
            </table>
<?php if($isCustomerLoggedIn): ?>
            <?php else: ?><label>Please log in to view seller details.</label><?php endif; ?>


        </div>

			</div>
		</div>
	</div>
<?php endif; ?>
<script type="text/javascript">
 function saveData(){
    var name = document.getElementById('name').value;
    var email = document.getElementById('email').value;
    var contact_number = document.getElementById('contact_number').value;
    var address = document.getElementById('address').value;
    var customer_id = document.getElementById('customer_id').value;
    var product_id = document.getElementById('product_id').value;

           new Ajax.Request("<?php echo $this->getUrl('createLog/index/save') ?>", {
               method: 'Post',
               parameters: {
                  "name" : document.getElementById('name').value,
                  "email" :document.getElementById('email').value,
                  "contact_number" : document.getElementById('contact_number').value,
                  "address" : document.getElementById('address').value,
                  "customer_id" : document.getElementById('customer_id').value,
                  "product_id" : document.getElementById('product_id').value
                            },
               onComplete: function(transport) {
                 console.log(transport);
                   alert(transport.responseText);

               }
           });
       }
</script>
<!--script type="text/javascript">
//<![CDATA[
    var dataForm = new VarienForm('form-validate', true);

//]]>
</script>
<!--table class="data-table" id="product-attribute-specs-table">
    <colgroup><col style="width: 25%">
    <col>
    </colgroup>
    <tbody>
      <tr>
        <th class="label" style="    color: black;"><b>Contact Number : <b></th>
        <td class="data">		<php 	echo $vendorInfo->getContactNumber(); ?></td>
      </tr>
      <tr>
        <th class="label" style="    color: black;"><b>Address</b></th>
        <td class="data">		<php 	echo $vendorInfo->getAddress(); ?></td>
      </tr>
    </tbody>
</table -->
